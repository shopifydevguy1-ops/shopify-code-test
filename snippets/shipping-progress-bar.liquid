{% comment %}
  Renders a dual-threshold free shipping progress bar
  
  Accepts:
  - cart: cart object
  - standard_threshold: number - threshold for free standard shipping (in dollars)
  - express_threshold: number - threshold for free express shipping (in dollars)
  
  Usage:
  {% render 'shipping-progress-bar',
    cart: cart,
    standard_threshold: 100,
    express_threshold: 250
  %}
{% endcomment %}

{{ 'component-shipping-progress.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign cart_total_dollars = cart.total_price | divided_by: 100.0
  assign standard_threshold = standard_threshold | default: 100
  assign express_threshold = express_threshold | default: 250
  
  # Calculate progress percentage and state
  if cart_total_dollars >= express_threshold
    assign progress_state = 'express-unlocked'
    assign progress_percent = 100
    assign amount_remaining = 0
    assign message = 'Free Express Shipping Unlocked!'
    assign icon = 'ðŸŽ‰'
  elsif cart_total_dollars >= standard_threshold
    assign progress_state = 'standard-unlocked'
    assign amount_to_express = express_threshold | minus: cart_total_dollars
    assign progress_range = express_threshold | minus: standard_threshold
    assign progress_from_standard = cart_total_dollars | minus: standard_threshold
    assign progress_percent = progress_from_standard | divided_by: progress_range | times: 50 | plus: 50 | at_most: 100
    assign amount_remaining = amount_to_express
    assign message = amount_to_express | money | append: ' to unlock Free Express Shipping!'
    assign icon = 'âœ“'
  else
    assign progress_state = 'standard-progress'
    assign amount_to_standard = standard_threshold | minus: cart_total_dollars
    assign progress_percent = cart_total_dollars | divided_by: standard_threshold | times: 50 | at_most: 50
    assign amount_remaining = amount_to_standard
    assign message = amount_to_standard | money | append: ' to unlock Free Express Shipping!'
    assign icon = ''
  endif
-%}

<div class="shipping-progress-wrapper" data-cart-total="{{ cart_total_dollars }}">
  <div class="shipping-progress {{ progress_state }}">
    {%- if progress_state == 'express-unlocked' -%}
      <div class="shipping-progress__message">
        <span class="shipping-progress__icon">{{ icon }}</span>
        <strong>{{ message }}</strong>
      </div>
    {%- else -%}
      <div class="shipping-progress__message">
        {%- if icon != '' -%}<span class="shipping-progress__icon">{{ icon }}</span>{%- endif -%}
        Add <strong>{{ message }}</strong>
      </div>
    {%- endif -%}
    
    <div class="shipping-progress__bar-wrapper">
      <div class="shipping-progress__bar-container">
        <div 
          class="shipping-progress__bar" 
          style="width: {{ progress_percent }}%;"
          role="progressbar"
          aria-valuenow="{{ progress_percent | round }}"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-label="Shipping progress: {{ progress_percent | round }}% complete"
        >
          <span class="shipping-progress__indicator">ðŸš¢</span>
        </div>
      </div>
      
      <div class="shipping-progress__labels">
        <span class="shipping-progress__label">Free Standard Shipping</span>
        <span class="shipping-progress__label">Free Express Shipping</span>
      </div>
    </div>
  </div>
</div>
