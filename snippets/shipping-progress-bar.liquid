{% comment %}
  Renders a dual-threshold free shipping progress bar
  
  Accepts:
  - cart: cart object
  - standard_threshold: number - threshold for free standard shipping (in dollars)
  - express_threshold: number - threshold for free express shipping (in dollars)
  
  Usage:
  {% render 'shipping-progress-bar',
    cart: cart,
    standard_threshold: 100,
    express_threshold: 250
  %}
{% endcomment %}

{{ 'component-shipping-progress.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign cart_total_dollars = cart.total_price | divided_by: 100.0
  assign standard_threshold = standard_threshold | default: 100
  assign express_threshold = express_threshold | default: 250
  
  # Calculate progress percentage
  if cart_total_dollars >= express_threshold
    assign progress_state = 'express-unlocked'
    assign progress_percent = 100
    assign amount_remaining = 0
  elsif cart_total_dollars >= standard_threshold
    assign progress_state = 'standard-unlocked'
    assign amount_to_express = express_threshold | minus: cart_total_dollars
    assign progress_range = express_threshold | minus: standard_threshold
    assign progress_from_standard = cart_total_dollars | minus: standard_threshold
    assign progress_percent = progress_from_standard | divided_by: progress_range | times: 100 | at_most: 100
    assign amount_remaining = amount_to_express
  else
    assign progress_state = 'standard-progress'
    assign amount_to_standard = standard_threshold | minus: cart_total_dollars
    assign progress_percent = cart_total_dollars | divided_by: standard_threshold | times: 100 | at_most: 100
    assign amount_remaining = amount_to_standard
  endif
-%}

<div class="shipping-progress-wrapper" data-cart-total="{{ cart_total_dollars }}">
  <div class="shipping-progress {{ progress_state }}">
    {%- if progress_state == 'express-unlocked' -%}
      <div class="shipping-progress__message shipping-progress__message--success">
        <span class="shipping-progress__icon">
          {{- 'icon-checkmark.svg' | inline_asset_content -}}
        </span>
        <span class="shipping-progress__text">
          ðŸŽ‰ <strong>Free Express Shipping Unlocked!</strong>
        </span>
      </div>
    {%- elsif progress_state == 'standard-unlocked' -%}
      <div class="shipping-progress__message">
        <span class="shipping-progress__icon">
          {{- 'icon-checkmark.svg' | inline_asset_content -}}
        </span>
        <span class="shipping-progress__text">
          âœ“ Free Standard Shipping! Add <strong>{{ amount_remaining | money }}</strong> for Free Express Shipping
        </span>
      </div>
    {%- else -%}
      <div class="shipping-progress__message">
        <span class="shipping-progress__icon">
          {{- 'icon-truck.svg' | inline_asset_content -}}
        </span>
        <span class="shipping-progress__text">
          Add <strong>{{ amount_remaining | money }}</strong> for Free Standard Shipping
        </span>
      </div>
    {%- endif -%}
    
    <div class="shipping-progress__bar-container">
      <div 
        class="shipping-progress__bar" 
        style="width: {{ progress_percent }}%;"
        role="progressbar"
        aria-valuenow="{{ progress_percent | round }}"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-label="Shipping progress: {{ progress_percent | round }}% complete"
      ></div>
      
      {%- if progress_state == 'standard-progress' -%}
        <div class="shipping-progress__milestone shipping-progress__milestone--standard" style="left: 100%;">
          <span class="shipping-progress__milestone-label">{{ standard_threshold | money }}</span>
        </div>
      {%- elsif progress_state == 'standard-unlocked' -%}
        <div class="shipping-progress__milestone shipping-progress__milestone--express" style="left: 100%;">
          <span class="shipping-progress__milestone-label">{{ express_threshold | money }}</span>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>
